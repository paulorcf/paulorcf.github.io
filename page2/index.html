<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      paulo castro blog! &middot; paulo castro blog
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="public/css/poole.css">
  <link rel="stylesheet" href="public/css/syntax.css">
  <link rel="stylesheet" href="public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="">
          paulo castro blog!
        </a>
      </h1>
      <p class="lead">it related stuffs!</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="">Home</a>

      

      
      
        
          
        
      
        
      
        
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      

	  <!-- <a class="sidebar-nav-item" href="https://github.com/paulorcf//archive/v2.1.0.zip">Download</a> -->
      <a class="sidebar-nav-item" href="https://github.com/paulorcf/">GitHub project</a>
      <span class="sidebar-nav-item">Currently v2.1.0</span>
    </nav>

    <p>&copy; 2017. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/10/planos-de-governo-presidente-2014/">
        Planos de governo &#8211; Presidente 2014
      </a>
    </h1>

    <span class="post-date">07 Oct 2014</span>

    <p>Vamos ao 2nd turno da Eleição.</p>

<p>Dilma:</p>

<p><a href="https://www.pt.org.br/wp-content/uploads/2014/07/Prog-de-Governo-Dilma-2014-INTERNET1.pdf">https://www.pt.org.br/wp-content/uploads/2014/07/Prog-de-Governo-Dilma-2014-INTERNET1.pdf</a></p>

<p>Aécio:</p>

<p><a href="http://static.psdb.org.br/wp-content/uploads/2014/07/diretrizes_plano_de_governo_aecio_neves-atualizado.pdf">http://static.psdb.org.br/wp-content/uploads/2014/07/diretrizes_plano_de_governo_aecio_neves-atualizado.pdf</a></p>

<p>Caso apaguem subi no blog:</p>

<p><a href="http://www.paulorcf.com/wp-content/uploads/2014/10/Prog-de-Governo-Dilma-2014-INTERNET1.pdf">Prog-de-Governo-Dilma-2014-INTERNET1</a></p>

<p><a href="https://www.dropbox.com/s/f255h21ww8dsjpn/diretrizes_plano_de_governo_aecio_neves-atualizado.pdf?dl=0" title="Prog-de-Governo-Aecio-2014">https://www.dropbox.com/s/f255h21ww8dsjpn/diretrizes_plano_de_governo_aecio_neves-atualizado.pdf?dl=0</a></p>

<p> </p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/04/topology-orchestration-specification-cloud-applications/">
        Topology and orchestration specification for cloud applications
      </a>
    </h1>

    <span class="post-date">29 Apr 2014</span>

    <div style="margin-bottom:5px">
  <strong> <a href="https://www.slideshare.net/OpenTOSCA/tosca-and-opentosca-tosca-introduction-and-opentosca-ecosystem-overview" title="TOSCA and OpenTOSCA: TOSCA Introduction and OpenTOSCA Ecosystem Overview" target="_blank">TOSCA and OpenTOSCA: TOSCA Introduction and OpenTOSCA Ecosystem Overview</a> </strong> from <strong><a href="http://www.slideshare.net/OpenTOSCA" target="_blank">OpenTOSCA</a></strong>
</div>

<p>TOSCA and OpenTOSCA: TOSCA Introduction and OpenTOSCA Ecosystem Overview.</p>

<p><a href="https://wiki.openstack.org/w/images/a/a1/TOSCA_in_Heat_-_20130415.pdf" target="_blank">Tosca in OpenStack HEAT.</a></p>

<p><a href="http://docs.oasis-open.org/tosca/TOSCA/v1.0/os/TOSCA-v1.0-os.html" target="_blank">OASIS Spec 1.0 – TOSCA</a></p>

<p><a href="https://www.oasis-open.org/committees/tc_home.php?wg_abbrev=tosca" target="_blank">OASIS – TOSCA page</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/04/palestra-tdc-cloud-computing-libvirt-e-libguestfs-o-caminho-automacao-da-virtualizacao/">
        Palestra TDC &#8211; Cloud Computing &#8211; Libvirt e Libguestfs &#8211; O caminho automação da virtualização
      </a>
    </h1>

    <span class="post-date">24 Apr 2014</span>

    <p>Palestra aprovada.</p>

<p><strong>Libvirt e Libguestfs – O caminho automação da virtualização</strong></p>

<p>Paulo Roberto de Castro Filho</p>

<p>Introdução a virtualização com open-source.</p>

<p>Arquitetura KVM e XEN.</p>

<p>Como domar e automatizar tarefas com diversos Hypervisors.</p>

<p>Libvirt é um toolkit que interage com sistemas de virtualização como Xen e KVM entre outros.</p>

<p>Libguestfs é outro toolkit para acessar e modificar discos de máquinas virtuais.</p>

<p><a href="http://www.paulorcf.com/wp-content/uploads/2014/04/libvirt_tdc2014_floripa.png"><img src="http://www.paulorcf.com/wp-content/uploads/2014/04/libvirt_tdc2014_floripa-1024x640.png" alt="Palestra TDC 2014 - Floripa" width="584" height="365" class="aligncenter size-large wp-image-91" srcset="http://www.paulorcf.com/wp-content/uploads/2014/04/libvirt_tdc2014_floripa-1024x640.png 1024w, http://www.paulorcf.com/wp-content/uploads/2014/04/libvirt_tdc2014_floripa-300x187.png 300w, http://www.paulorcf.com/wp-content/uploads/2014/04/libvirt_tdc2014_floripa-500x312.png 500w, http://www.paulorcf.com/wp-content/uploads/2014/04/libvirt_tdc2014_floripa.png 1280w" sizes="(max-width: 584px) 100vw, 584px" /></a></p>

<p><a href="http://www.thedevelopersconference.com.br/tdc/2014/inscricoes" target="_blank">Participe!</a></p>

<p>Data e Local</p>

<p>Sexta-feira, 16 de Maio de 2014</p>

<p>8:30 às 18:30</p>

<p><a href="http://www.oceaniaparkhotel.com.br/centro-convencoes/" target="_blank">Oceania Convention Center</a></p>

<p>Rua do Marisco, 550 – 88058-090</p>

<table>
  <tbody>
    <tr>
      <td>Praia dos Ingleses</td>
      <td>Florianópolis – SC</td>
    </tr>
  </tbody>
</table>

<p><a href="http://www.thedevelopersconference.com.br/tdc/2014/data-e-local" target="_blank">Informações sobre Data e Local</a></p>

<p>Mais informações: <a href="http://www.thedevelopersconference.com.br/tdc/2014/florianopolis/trilha-cloud-computing">http://www.thedevelopersconference.com.br/tdc/2014/florianopolis/trilha-cloud-computing</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/04/kill-running-thread-jboss/">
        Killing running thread in JBoss
      </a>
    </h1>

    <span class="post-date">24 Apr 2014</span>

    <p>Quick how to, check update to more information. Worked with JBoss 6.1 EAP.</p>

<p>This not work with locked thread.</p>

<p>Checking process PID</p>

<pre class="lang:sh decode:true ">jps</pre>

<p>Output something like this:</p>

<p>12124 Jps</p>

<p>24541 jboss-modules.jar</p>

<p>Generate DUMP for JBoss Process</p>

<pre class="lang:sh decode:true ">jstack 24541 &gt;&gt; /tmp/dump_24042014_1754.txt  # 24541 is JBoss PID</pre>

<p>Checking the Thread name</p>

<pre class="lang:sh decode:true ">cat /tmp/dump_24042014_1754.txt | grep -i "http-/0.0.0.0:8080-9"</pre>

<p>Output something like this:</p>

<p>“http-/0.0.0.0:8080-9” daemon prio=10 tid=0x00007f2ea8094800 nid=0x6073 runnable [0x00007f2e9df10000]</p>

<p>Running JKillThread</p>

<pre class="lang:sh decode:true " title="running JKillThread">java -jar jkillthread-1.0-SNAPSHOT.jar 24541 "http-/0.0.0.0:8080-9"
# 24541 is JBoss PID
# Thread Name is "http-/0.0.0.0:8080-9"</pre>

<p>Checking in JBoss log (standalone running mode)</p>

<pre class="lang:sh decode:true " title="reading JBoss log">tail -50f /usr/java/jboss-eap-6.2/standalone/log/server.log</pre>

<p>Output something like:</p>

<pre class="lang:sh decode:true " title="output JBoss">24-04-2014 17:56:10,410 ERROR [stderr] (Attach Listener) Killing "http-/0.0.0.0:8080-9"</pre>

<p>References and Resources</p>

<p><a href="https://github.com/jglick/jkillthread">JKillThread</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/04/parsible/">
        Parsible &#8211; Transforme seu log em informação qualitativa
      </a>
    </h1>

    <span class="post-date">24 Apr 2014</span>

    <p>Precisava à partir do log do XEN – LIBXL obter informações sobre mudança de estados das máquinas virtuais.</p>

<p>Parsible é uma ferramenta que faz parser de log e ajuda a transformar em informação qualitativa. O ciclo de leitura do arquivo e stream de linha por linha fica a cargo do Parsible, sendo assim, desenvolvedor só precisa escrever uma função de parser.</p>

<p>O Parsible abre uma thread que fica lendo o arquivo de trás para frente (igual um tail -f), já está pronto para rotate de log e fica a cargo do desenvolvedor rodar apenas um parser ou carregar todos os parsers.</p>

<p>Fluxo básico (mais detalhes diagrama de sequência abaixo):</p>

<p>Arquivo atualizado -&gt; parse -&gt; processor -&gt; output.</p>

<p>Output pode chamar um serviço REST, mandar os dados para um Riemann ou Graphite.</p>

<p><strong>Diagramas:</strong></p>

<p><a href="http://www.paulorcf.com/wp-content/uploads/2014/04/Abstract_Parsible_Class_Diagram.png"><img src="http://www.paulorcf.com/wp-content/uploads/2014/04/Abstract_Parsible_Class_Diagram-1024x710.png" alt="Abstract_Parsible_Class_Diagram" width="584" height="404" class="aligncenter size-large wp-image-66" srcset="http://www.paulorcf.com/wp-content/uploads/2014/04/Abstract_Parsible_Class_Diagram-1024x710.png 1024w, http://www.paulorcf.com/wp-content/uploads/2014/04/Abstract_Parsible_Class_Diagram-300x208.png 300w, http://www.paulorcf.com/wp-content/uploads/2014/04/Abstract_Parsible_Class_Diagram-500x347.png 500w, http://www.paulorcf.com/wp-content/uploads/2014/04/Abstract_Parsible_Class_Diagram.png 1210w" sizes="(max-width: 584px) 100vw, 584px" /></a></p>

<p><a href="http://www.paulorcf.com/wp-content/uploads/2014/04/Abstract_Flow_Parsible_Sequence_Diagram.png"><img src="http://www.paulorcf.com/wp-content/uploads/2014/04/Abstract_Flow_Parsible_Sequence_Diagram-1024x530.png" alt="Abstract_Flow_Parsible_Sequence_Diagram" width="584" height="302" class="aligncenter size-large wp-image-65" srcset="http://www.paulorcf.com/wp-content/uploads/2014/04/Abstract_Flow_Parsible_Sequence_Diagram-1024x530.png 1024w, http://www.paulorcf.com/wp-content/uploads/2014/04/Abstract_Flow_Parsible_Sequence_Diagram-300x155.png 300w, http://www.paulorcf.com/wp-content/uploads/2014/04/Abstract_Flow_Parsible_Sequence_Diagram-500x258.png 500w, http://www.paulorcf.com/wp-content/uploads/2014/04/Abstract_Flow_Parsible_Sequence_Diagram.png 1433w" sizes="(max-width: 584px) 100vw, 584px" /></a></p>

<p><strong>Exemplos:</strong></p>

<pre class="lang:python mark:5 decode:true " title="xen42.py - Parser">import re
import logging


def parse_xend42(line):
    """
    This parser try parser only details information about xend42 events.
        Example:
            [2014-03-25 13:17:02 2140] INFO (XendDomainInfo:2079) Domain has shutdown: name=CD976431-linux-centos-6-64b-base-sx-1819 id=5
            30 reason=poweroff.

            [2014-03-26 12:00:33 2140] INFO (XendDomainInfo:2079) Domain has shutdown: name=tempoexpress id=549 reason=reboot.

            [2014-03-26 12:05:16 2140] INFO (XendDomainInfo:2079) Domain has shutdown: name=tempoexpress id=550 reason=poweroff.

        They extract this information:
            @Parsed
            libname (XendDomainInfo:2079)
            loglevel INFO
            actionDetail reason=poweroff. : split("=") get only poweroff
            date [2014-03-25 : strip [

            time 13:17:02
            action shutdown:
            vmName name=CD976431-linux-centos-6-64b-base-sx-1819 : split("=") get only CD976431-linux-centos-6-64b-base-sx-1819
            id id=530 : split("=") get only 530

            @Ignored for now:
            domain Domain
            has has
            timeid 2140]
    """
    line = line.strip()

    # Shutdown
    regex = re.compile("(?P&lt;date&gt;[\w\S]+)\s(?P&lt;time&gt;[\w\S]+)\s(?P&lt;timeid&gt;[\w\S]+)\s(?P&lt;loglevel&gt;[\w\S]+)\s(?P&lt;libname&gt;[\w\S]+)\s(?P&lt;domain&gt;[\w\S]+)\s(?P&lt;has&gt;[\w\S]+)\s(?P&lt;action&gt;[\w\S]+)\s(?P&lt;vmName&gt;[\w\S]+)\s(?P&lt;id&gt;[\w\S]+)\s(?P&lt;actionDetail&gt;[\w\S]+)")
    r = regex.search(line)
    result_set = {}
    if r:
        try:
            result_set["libname"] = r.group("libname")
            logging.debug("Get libname=%s, OK!" % result_set["libname"])

            result_set["loglevel"] = r.group("loglevel")
            logging.debug("Get loglevel, OK!")

            lreport = r.group("actionDetail").split("=")
            result_set["actionDetail"] = lreport[1][:-1]  # strip .
            logging.debug("Get actionDetail=%s, OK!" % result_set["actionDetail"])

            result_set["date"] = r.group("date")[1:]  # strip first char [
            logging.debug("Get date=%s, OK!" % result_set["date"])

            result_set["time"] = r.group("time")
            logging.debug("Get time=%s, OK!" % result_set["time"])

            result_set["action"] = r.group("action")[:-1]  # strip .
            logging.debug("Get action=%s, OK!" % result_set["action"])

            lvmName = r.group("vmName").split("=")
            result_set["vmName"] = lvmName[1]
            logging.debug("Get vmName=%s, OK!" % result_set["vmName"])

            lID = r.group("id").split("=")
            result_set["id"] = lID[1]
            logging.debug("Get id=%s, OK!" % result_set["id"])

        except IndexError:
            logging.error("Unable parser information in libxl, some regex group missing")

    # CRASHED
    regex = re.compile("(?P&lt;date&gt;[\w\S]+)\s(?P&lt;time&gt;[\w\S]+)\s(?P&lt;timeid&gt;[\w\S]+)\s(?P&lt;loglevel&gt;[\w\S]+)\s(?P&lt;libname&gt;[\w\S]+)\s(?P&lt;domain&gt;[\w\S]+)\s(?P&lt;has&gt;[\w\S]+)\s(?P&lt;action&gt;[\w\S]+)\s(?P&lt;vmName&gt;[\w\S]+)\s(?P&lt;id&gt;[\w\S]+)")
    r = regex.search(line)
    result_set = {}
    if r:
        try:
            result_set["libname"] = r.group("libname")
            logging.debug("Get libname=%s, OK!" % result_set["libname"])

            result_set["loglevel"] = r.group("loglevel")
            logging.debug("Get loglevel, OK!")

            result_set["date"] = r.group("date")[1:]  # strip first char [
            logging.debug("Get date=%s, OK!" % result_set["date"])

            result_set["time"] = r.group("time")
            logging.debug("Get time=%s, OK!" % result_set["time"])

            result_set["action"] = r.group("action")[:-1]  # strip .
            logging.debug("Get action=%s, OK!" % result_set["action"])

            result_set["actionDetail"] = r.group("action")[:-1]  # strip .
            logging.debug("Get actionDetail=%s, OK!" % result_set["actionDetail"])

            lvmName = r.group("vmName").split("=")
            result_set["vmName"] = lvmName[1]
            logging.debug("Get vmName=%s, OK!" % result_set["vmName"])

            lID = r.group("id").split("=")
            result_set["id"] = lID[1]
            logging.debug("Get id=%s, OK!" % result_set["id"])

        except IndexError:
            logging.error("Unable parser information in libxl, some regex group missing")

    else:
        logging.debug("Not value found on regex")

    return result_set</pre>

<pre class="lang:python mark:5 decode:true " title="pxend42.py - Processor">import logging
from audit.plugins.outputs import output_libvirt_events


def process_action_shutdown(result):
    """

    """
    # TODO: Fix the if hierarchy and prop for action - Crashed and Shutdown repeated
    #if not result.viewkeys() &amp; {'libname', 'actionDetail', 'action', 'vmName'}:
    if all(k in result for k in ("libname", 'actionDetail', "action", "vmName")):
        if result['libname'] == "(XendDomainInfo:2079)":

            if result['action'] == "shutdown":
                logging.debug("Shutdown event to vmName=%s and detail=%s " % (result['vmName'], result['actionDetail']))
                output_libvirt_events.broadcast_shutdown(result['vmName'], result['actionDetail'])

            elif result['action'] == "crashed":
                logging.debug("Shutdown event to vmName=%s and detail=%s " % (result['vmName'], result['actionDetail']))
                output_libvirt_events.broadcast_shutdown(result['vmName'], result['actionDetail'])

        else:
            logging.error("Detected action not implemented %s" % result['action'])

    else:
        logging.error("Detected shutdown in processor but parse can't get details")</pre>

<pre class="lang:default mark:7 decode:true " title="output_libvirt_events.py - Outputs">import logging
from audit import VMProp
# import deleted from code
# import deleted from code

def broadcast_shutdown(vmName, actionDetail ):
    """
    Set the last detail information on global event_libvirt
        :event_libvirt = { vmName : lastStated }

    In Python documentation Dict is atomic. If you don't believe that try QUEUE.
    """
    tmp = {}
    if actionDetail == VMProp.vmState_SHUTTING_DOWN_DETAIL.lower():
        logging.debug("output called with action %s" + Utils.get_callee_name())
        API.set_vm_shutdown(vmName, VMProp.vmState_POWEROFF)

    elif actionDetail == VMProp.vmState_POWEROFF_CRASHED.lower():
        logging.debug("output called with action %s" + Utils.get_callee_name())
        API.set_vm_crashed(vmName)

    elif actionDetail == VMProp.vmState_POWEROFF_REBOOT.lower():
        logging.debug("output called with action %s" + Utils.get_callee_name())
        API.set_vm_shutdown(vmName, VMProp.vmState_POWEROFF_REBOOT)

    else:
        tmp[vmName] = None
        logging.error("Trying broadcast a new shutdown details but don't recognized actionDetail=%s " % actionDetail)</pre>

<p>References e resources:</p>

<p><a href="http://tech.yipit.com/2012/08/03/parsible-straightforward-log-parsing/" target="_blank">http://tech.yipit.com/2012/08/03/parsible-straightforward-log-parsing/</a></p>

<p><a href="http://github.com/Yipit/parsible">http://github.com/Yipit/parsible</a></p>

<p><a href="https://github.com/paulorcf/parsible" title="Parser e Processor para LibXL">https://github.com/paulorcf/parsible</a></p>

<p><a href="http://www.paulorcf.com/wp-content/uploads/2014/04/parsible_conceptual_diagram_jude_v1.tar.gz">parsible_conceptual_diagram_jude_v1.tar</a></p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="page3">Older</a>
  
  
    
      <a class="pagination-item newer" href="">Newer</a>
    
  
</div>
    </div>

	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45806948-1', 'auto');
    ga('send', 'pageview');
</script>

  
  </body>
</html>
